---
title: Create a Matugen template
description: This guide walks you through adding a new Matugen template to Noctalia.
sidebar:
  order: 5
---

This guide walks you through adding a new **Matugen** template to **Noctalia**.

The system is designed to be dynamic: once you register a template, it automatically appears in the settings UI.

---

## Overview

Adding a new template involves just two steps:

1. [Create the template file](#step-1-create-the-template-file)
2. [Register the template](#step-2-register-the-template)

---

## Step 1: Create the Template File

Create your template file in the Matugen templates directory.
For example, if you're making one for kitty, create:

**`Assets/MatugenTemplates/Terminal/kitty.conf`**

```ini
color0 {{colors.surface.default.hex}}
color1 {{colors.error.default.hex}}
color2 {{colors.tertiary.default.hex}}
color3 {{colors.secondary.default.hex}}
color4 {{colors.primary.default.hex}}
color5 {{colors.tertiary_fixed_dim.default.hex}}
color6 {{colors.secondary_fixed_dim.default.hex}}
color7 {{colors.on_surface.default.hex}}
color8 {{colors.outline.default.hex}}
color9 {{colors.error.default.hex}}
color10 {{colors.tertiary.default.hex}}
color11 {{colors.secondary.default.hex}}
color12 {{colors.primary.default.hex}}
color13 {{colors.tertiary_fixed_dim.default.hex}}
color14 {{colors.secondary_fixed_dim.default.hex}}
color15 {{colors.on_surface.default.hex}}

cursor                {{colors.on_surface.default.hex}}
cursor_text_color     {{colors.surface.default.hex}}
background            {{colors.surface.default.hex}}
foreground            {{colors.on_surface.default.hex}}
selection_foreground  {{colors.on_surface_variant.default.hex}}
selection_background  {{colors.surface_variant.default.hex}}
url_color             {{colors.primary.default.hex}}
```

Matugen uses template variables to map Material Design 3 colors to different app formats.
You can find all the available variables and their Material 3 mappings in the [Matugen wiki](https://github.com/InioX/matugen/wiki).

---

## Step 2: Register the Template

You need to tell the system about your template. Open **`Services/Theming/TemplateRegistry.qml`**.

There are two main categories: **Terminals** and **Applications**.

### For Terminal Emulators
Add to the `terminals` array:

```qml
{
  "id": "kitty",
  "name": "Kitty",
  "matugenPath": "Terminal/kitty.conf",
  "outputPath": "~/.config/kitty/themes/noctalia.conf"
}
```

### For Applications
Add to the `applications` array:

```qml
{
  "id": "myapp",
  "name": "My App",
  "category": "misc", // See categories below
  "input": "myapp.conf",
  "outputs": [
    {
      "path": "~/.config/myapp/themes/noctalia.conf"
    }
  ],
  // Optional: Run a command after generating colors (e.g. to reload the app)
  "postProcess": () => `${colorsApplyScript} myapp`
}
```

Once registered:
1. The template will automatically appear in **Settings > Color Scheme > Templates**.
2. The UI will automatically show the target path in the tooltip.
3. The state (enabled/disabled) is automatically saved in `Settings.qml`'s `activeTemplates` listâ€”you do **not** need to add any properties to `Settings.qml` manually.

---

## Template Categories

Use the `category` property to organize your template in the settings UI:

- `system` (GTK, Qt, KDE)
- `terminal` (Terminal emulators - automatically assigned for `terminals` array)
- `launcher` (App launchers)
- `browser` (Web browsers)
- `editor` (Code editors)
- `audio` (Music players, visualizers)
- `compositor` (Hyprland, Niri, etc.)
- `misc` (Everything else)

---

## How Color Generation Works

Noctalia supports two different color generation modes:

### Wallpaper-Based Colors
When `Settings.data.colorSchemes.useWallpaperColors` is enabled, the system uses Matugen to analyze the current wallpaper and generates a complete Material Design 3 color palette. This palette is then used to generate all enabled templates using the standard Matugen workflow.

### Predefined Color Schemes
When wallpaper colors are disabled, Noctalia uses predefined color schemes (like Nord, Dracula, Catppuccin, etc.). For these schemes, the system:

1. **Generates a Material Design 3 palette** - Uses `ColorsConvert.js` helper functions to create a complete Material Design 3 color palette from the predefined scheme's key colors
2. **Maps predefined colors intelligently** - Primary, secondary, tertiary, error, and surface colors from the predefined scheme are used as the foundation
3. **Generates complementary colors** - Container colors, "on" colors (for text/icons), surface variants, and outline colors are generated using color theory algorithms
4. **Processes templates directly** - Templates are copied and color placeholders are replaced with the generated Material Design 3 colors using `sed`

This approach ensures that predefined color schemes maintain their authentic look while providing a complete Material Design 3 palette for consistent theming across all applications.

:::info[**Terminal Templates**]
Terminal templates are handled specially - they use predefined color schemes directly for better contrast and readability rather than the generated Material Design 3 palette. This ensures terminal applications have optimal readability with high contrast colors.
:::

---

## User Templates

Users can create their own templates without modifying the codebase:

1. Enable "User Templates" in **Settings > Color Scheme > Templates**.
2. This creates a `user-templates.toml` in `~/.config/noctalia/`.
3. Add custom templates to this TOML file.

User templates are automatically executed after the main matugen command when enabled.

---

## Template Development Tips

### Testing Your Template
1. Enable your template in the settings.
2. Switch between different predefined color schemes to verify compatibility.
3. Test with both wallpaper-based and predefined color schemes.
4. Verify that the generated files are placed in the correct locations.

### Common Issues
- **Path expansion**: always use `~` in output paths; the system handles tilde expansion automatically.
- **Color mapping**: ensure your template uses the correct Material Design 3 color tokens.
- **Post hooks**: Use `colorsApplyScript` (exposed in `TemplateRegistry`) for common reload commands in `bin/colors-apply.sh`.


